# 悟道 - 功能需求文档

## 1. 产品愿景

**悟道**旨在成为一款深度整合个人成长理论的数字化工具，帮助用户：

- 系统化管理人生目标（从愿景到行动）
- 科学培养持久习惯（理解触发机制）
- 记录和沉淀人生感悟（运动、工作、生活）
- 构建个人知识体系（问题与解决方案）

**核心理念**: 以终为始 + 触发机制 + 持续反思

---

## 2. 目标用户

**主要用户**: 追求自我成长的个人

- 年龄: 25-45 岁
- 职业: 知识工作者、创业者、专业人士
- 特征:
  - 阅读过《高效能人士的七个习惯》等自我管理书籍
  - 希望系统化管理人生目标
  - 需要工具支持习惯养成
  - 有记录和反思的习惯

**使用场景**:

1. 年度计划时：梳理人生愿景和年度目标
2. 每日晨间：查看今日目标和习惯清单
3. 运动后：记录运动感悟和技术心得
4. 工作中：查询知识库中的解决方案
5. 睡前：回顾今日进展，反思改进点

---

## 3. 核心功能需求

### 3.1 人生目标管理（Phase 1）

#### 3.1.1 目标层级结构

**需求描述**:  
支持 5 层目标层级，从人生愿景到具体项目：

```
人生愿景（Life）
  └─ 领域目标（Career, Health, Family, Finance, Learning）
      └─ 年度目标（2025, 2026...）
          └─ 季度目标（Q1, Q2, Q3, Q4）
              └─ 具体项目/行动（Project_X）
```

**功能要点**:

- 每个目标可以有多个子目标
- 支持跨层级查看（例如查看所有 Career 相关目标）
- 目标路径自动生成（如 `Life.Career.2025.Q1.Project_X`）
- 可折叠/展开的树形视图

**用户故事**:

```
作为用户，我希望创建「成为技术领导者」的职业目标，
并将其分解为「2025 年晋升 Tech Lead」的年度目标，
再细化为「Q1 完成系统架构设计课程」的季度目标，
以便我能清晰地看到从愿景到行动的路径。
```

#### 3.1.2 目标属性

每个目标包含以下属性：

- **基础信息**:
  - 名称（必填，最多 100 字）
  - 描述（选填，支持 Markdown，最多 1000 字）
  - 所属层级（自动识别）
  - 父目标（除顶层外必选）
  
- **状态管理**:
  - 状态: 活跃 | 已完成 | 已归档 | 暂停
  - 优先级: P1（最高）- P5（最低）
  - 进度: 0-100% （自动或手动）
  
- **时间相关**:
  - 创建时间
  - 更新时间
  - 目标截止日期（选填）
  - 完成时间（状态=已完成时自动记录）

#### 3.1.3 目标操作

**创建目标**:

- 点击「+」按钮选择父目标
- 填写名称、描述、优先级、截止日期
- 系统自动生成路径（基于父目标）
- 支持快速创建（仅名称+父目标）

**编辑目标**:

- 修改所有属性（除路径外）
- 移动到其他父目标（自动更新路径）
- 调整优先级和进度
- 添加/修改描述

**删除目标**:

- 软删除（标记为已归档）
- 提示: 删除父目标时的子目标处理
  - 选项 1: 同时归档所有子目标
  - 选项 2: 将子目标提升到上一层

**查看目标**:

- 树形视图（默认）
- 列表视图（按优先级/截止日期排序）
- 筛选: 按状态、优先级、层级筛选
- 搜索: 全文搜索目标名称和描述

#### 3.1.4 进度计算

**自动进度**（父目标）:

```
父目标进度 = Σ(子目标进度 × 子目标权重) / Σ(子目标权重)
默认权重 = 1
```

**手动进度**（叶子目标）:

- 用户直接设置 0-100%
- 支持快捷操作：0%, 25%, 50%, 75%, 100%

#### 3.1.5 UI/UX 要求

- **iOS 风格**: 使用 Cupertino 组件
- **玻璃效果**: 导航栏、底部栏使用毛玻璃效果（liquid_glass_bottom_bar）
- **底部导航**:
  - 使用 liquid_glass_bottom_bar 实现玻璃拟态效果
  - 4 个标签页：目标、习惯、灵感、我的
  - 使用 Cupertino 风格图标
  - 平滑的页面切换动画
  - 使用 Riverpod 管理选中状态
- **动画**: 目标展开/折叠使用平滑动画
- **手势**:
  - 左滑显示「编辑」「归档」按钮
  - 长按显示快捷菜单
- **空状态**: 精美的空状态插图 + 引导文案
- **加载状态**: iOS 风格的 ActivityIndicator

---

### 3.2 习惯追踪系统（Phase 2）

#### 3.2.1 习惯定义

**习惯属性**:

- 名称（如「晨间冥想」）
- 描述（习惯的意义和目标）
- 类型:
  - 每日习惯（每天执行）
  - 每周习惯（指定星期几）
  - 计数习惯（如「每天喝 8 杯水」）
- **触发机制**（核心特性）:
  - 时间触发: "早上 7:00"
  - 情境触发: "刷牙后" / "下班回家时"
  - 前置习惯: "完成晨练后"

**关联目标**:

- 每个习惯可关联到一个目标
- 目标详情页显示相关习惯的完成情况

#### 3.2.2 习惯打卡

**打卡界面**:

- 今日习惯清单（按时间/优先级排序）
- 一键打卡（✓ 图标）
- 计数习惯显示进度条
- 显示连续打卡天数

**打卡数据**:

- 记录时间戳
- 对于计数习惯，记录具体数值
- 支持补卡（过去 7 天内）
- 支持取消打卡

#### 3.2.3 习惯统计

**个人统计**:

- 总打卡天数
- 当前最长连续天数
- 历史最长连续天数
- 完成率（本周/本月/本年）

**习惯热力图**:

- GitHub 风格的年度热力图
- 颜色深浅表示完成质量

**趋势分析**:

- 折线图显示完成率趋势
- 识别容易失败的时间段
- 触发机制有效性分析

---

### 3.3 灵感记录与反思（Phase 3）

#### 3.3.1 反思类型

**运动反思**:

- 活动类型（羽毛球/网球/健身/跑步）
- 技术要点（如您提供的例子）
- 感悟与改进
- 关联视频/图片

**工作反思**:

- 项目名称
- 遇到的问题
- 解决方案
- 经验教训
- 关联目标

**生活反思**:

- 事件描述
- 情绪记录
- 思考与感悟
- 行动计划

#### 3.3.2 记录界面

**创建反思**:

- 选择类型（自动显示对应模板）
- 富文本编辑器（支持 Markdown）
- 图片/视频上传
- 标签系统
- 关联目标（可选）

**查看反思**:

- 时间线视图（按时间倒序）
- 网格视图（卡片式）
- 筛选: 按类型、标签、目标筛选
- 搜索: 全文搜索

---

### 3.4 知识库系统（Phase 4）

#### 3.4.1 知识条目

**属性**:

- 标题
- 内容（Markdown）
- 类型: 问题 | 解决方案 | 笔记 | 资源
- 分类（可自定义）
- 标签（多个）
- 来源（如某本书、某课程）

**关联**:

- 关联到目标
- 引用其他知识条目
- 附件（PDF/图片/链接）

#### 3.4.2 搜索功能

**全文搜索**:

- 搜索标题和内容
- 高亮显示匹配词
- 按相关度排序

**高级搜索**:

- 按分类、标签组合筛选
- 按创建/更新时间筛选
- 收藏的内容

---

## 4. 非功能需求

### 4.1 性能要求

- **启动时间**: < 2 秒（冷启动）
- **页面切换**: < 300ms（流畅 60fps）
- **数据加载**: < 1 秒（网络正常情况）
- **离线响应**: 即时（0 延迟）
- **同步速度**: < 5 秒（增量同步）

### 4.2 可用性要求

- **学习曲线**: 首次使用 < 5 分钟上手核心功能
- **操作效率**: 创建一个目标 < 30 秒
- **错误恢复**: 所有操作可撤销/恢复
- **引导帮助**: 首次使用有引导流程

### 4.3 兼容性要求

- **iOS**: 16.0+
- **macOS**: 13.0+
- **Android**: 10.0+ (API Level 29+)
- **Web**: 现代浏览器（Chrome/Safari/Edge 最新两个版本）

### 4.4 安全性要求

- **数据传输**: HTTPS/TLS 1.3
- **数据存储**:
  - 敏感字段 AES-256 加密
  - 本地 SQLite 数据库加密（SQLCipher）
- **认证**:
  - Phase 1: API Key（SHA256 哈希）
  - Phase 5: JWT Token（24小时过期）
- **隐私**:
  - 所有数据自托管
  - 无第三方分析工具
  - 无广告

### 4.5 可维护性要求

- **代码质量**:
  - Dart Analyzer 0 警告
  - Go lint 通过
  - 测试覆盖率 > 60%
- **文档**:
  - API 有完整 Swagger 文档
  - 代码有充分注释
  - README 和用户手册完整
- **日志**:
  - 分级日志（Debug/Info/Error）
  - 错误追踪（崩溃报告）

### 4.6 开发环境要求

- **Flutter 版本管理**:
  - 使用 FVM 管理 Flutter 版本
  - VS Code 配置 `"dart.flutterSdkPath": ".fvm/flutter_sdk"` 使用符号链接
  - 避免使用相对路径 `.fvm/versions/x.x.x`（可能导致 Dart 扩展无法识别）
  - 修改配置后重启 Dart Analysis Server

- **macOS 平台配置**:
  - 调试模式需要网络权限：
    - `DebugProfile.entitlements` 添加 `network.server` 和 `network.client`
    - `Release.entitlements` 添加 `network.client`
  - 修改 entitlements 后执行 `flutter clean`
  - VS Code 调试配置需要正确的 SDK 路径

- **开发工具**:
  - VS Code 或 Android Studio + Dart/Flutter 插件
  - Docker Desktop（用于 PostgreSQL）
  - Postman 或 Swagger UI（用于 API 测试）
  - Git（版本控制）

---

## 5. 约束条件

### 5.1 技术约束

- **前端**: 必须使用 Flutter 3.35+
- **后端**: 必须使用 Go 1.23+
- **数据库**: 必须使用 PostgreSQL 16+
- **部署**: 必须支持 Docker Compose

### 5.2 资源约束

- **开发时间**: Phase 1 必须在 6 周内完成
- **预算**: 自托管，无云服务费用
- **人力**: 1 名全栈开发者（您）+ AI 助手

### 5.3 业务约束

- **用户规模**: Phase 1-4 仅个人使用
- **数据量**:
  - 目标: < 500 个
  - 习惯: < 50 个
  - 反思: < 5000 条
  - 知识库: < 1000 条

---

## 6. 未来规划（Phase 5+）

### 6.1 高级分析功能

- **目标达成率分析**: 各领域目标完成情况对比
- **习惯相关性分析**: 发现哪些习惯组合效果最好
- **时间分配分析**: 在各目标上投入的时间统计
- **趋势预测**: 基于历史数据预测目标完成可能性

### 6.2 协作功能

- **多用户支持**: 用户注册和登录
- **目标分享**: 分享目标给他人查看
- **习惯挑战**: 和朋友一起培养习惯
- **导师模式**: 邀请导师查看和指导

### 6.3 集成功能

- **日历集成**: 与 iOS/Google 日历同步目标和习惯
- **健康数据**: 读取 Apple Health 运动数据
- **通知系统**: 基于触发机制的智能提醒
- **导出导入**: 支持多种格式（PDF/Markdown/JSON）

### 6.4 AI 增强

- **智能建议**: AI 根据目标推荐习惯
- **反思总结**: AI 生成周/月反思报告
- **知识关联**: AI 自动关联相关知识条目
- **问答系统**: 基于个人知识库的 AI 问答

---

## 7. 验收标准

### Phase 1 验收标准

✅ **功能完整性**:

- [ ] 可以创建 5 层层级目标
- [ ] 目标 CRUD 所有操作正常
- [ ] 进度自动计算准确
- [ ] 目标筛选和搜索有效

✅ **用户体验**:

- [ ] iOS 风格 UI 美观流畅
- [ ] 离线操作即时响应
- [ ] 在线同步无感知
- [ ] 错误提示友好清晰

✅ **技术指标**:

- [ ] 启动时间 < 2 秒
- [ ] 页面切换流畅 60fps
- [ ] 测试覆盖率 > 60%
- [ ] 0 严重 Bug

✅ **部署就绪**:

- [ ] Docker Compose 一键启动
- [ ] API 文档完整
- [ ] 用户手册可用
- [ ] 数据备份方案就绪

---

## 8. 附录

### 8.1 用户故事地图

```
用户旅程: 设定和追踪年度目标

1. 新年规划
   - 创建年度愿景
   - 分解到各领域
   - 设定关键指标

2. 季度计划
   - 创建季度目标
   - 分解具体项目
   - 估算时间和优先级

3. 日常执行
   - 查看今日目标
   - 更新进度
   - 记录反思

4. 定期回顾
   - 查看完成情况
   - 分析问题原因
   - 调整下阶段目标
```

### 8.2 术语表

- **人生愿景**: 最高层级的长期目标（通常是 5-10 年的期望）
- **领域目标**: 人生各重要领域的目标（事业、健康、家庭等）
- **触发机制**: 启动习惯行为的外部或内部信号
- **连续打卡**: 习惯连续完成的天数
- **离线优先**: 先操作本地数据，再同步到云端的架构模式
- **ltree**: PostgreSQL 扩展，用于存储和查询层级数据

---

**文档版本**: v1.0  
**最后更新**: 2025-10-01  
**维护者**: 项目团队
