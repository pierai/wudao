# 悟道 - 常见问题解答 (FAQ)

## 📋 习惯追踪相关

### Q1: 习惯列表的"今日打卡"和"次日计划完成暗示并打卡"有什么区别？

这是两种不同的打卡方式，适用于不同的场景。

#### 🎯 核心区别

| 维度 | 直接打卡 | 计划式打卡 |
|------|---------|-----------|
| **触发方式** | 已完成行为后记录 | 按计划执行，先暗示后行为 |
| **习惯循环** | 仅记录"惯常行为" | 完整体验"暗示→行为→奖赏" |
| **计划关联** | 无关联 | 与次日计划关联 |
| **适合场景** | 临时、灵活打卡 | 培养新习惯、强化触发机制 |
| **心理强化** | 事后记录 | 事前计划 + 过程执行 |

#### 1️⃣ 习惯列表的"今日打卡"（直接打卡）

**触发场景**：
- 你已经完成了某个习惯的**惯常行为**
- 直接在习惯列表点击"打卡"按钮

**流程**：
```
习惯列表 → 点击打卡按钮 → 填写执行信息 → 完成
```

**记录内容**：
- ✅ 执行时间
- ✅ 执行质量（1-5星）
- ✅ 执行笔记（可选）

**适用场景**：
- 已经养成的稳定习惯（如每天刷牙）
- 临时完成的习惯（如补打卡昨天的运动）
- 不需要提前计划的习惯

**实际例子**：
```
今天去了图书馆学习
→ 回家后在习惯列表点击"打卡"
→ 记录：学习了3小时，质量5星
```

#### 2️⃣ 次日计划"完成暗示并打卡"（计划式打卡）

**触发场景**：
- 你提前在次日计划中设置了这个习惯的**暗示**
- 按照计划执行，先完成暗示，再执行惯常行为

**流程**：
```
次日计划 → 完成暗示任务 → 弹出确认 → 选择"完成并打卡"
→ 执行惯常行为 → 填写打卡信息
```

**特点**：
- ✅ 强化**习惯循环**（暗示 → 惯常行为 → 奖赏）
- ✅ 提醒你先完成暗示（触发条件）
- ✅ 暗示完成后再执行惯常行为
- ✅ 计划与打卡关联（记录 recordId）

**适用场景**：
- 正在培养的新习惯（需要暗示提醒）
- 容易忘记的习惯（需要计划提醒）
- 想要强化触发机制的习惯（如"看到书包→去图书馆"）
- **核心习惯**（💎 标记的习惯，建议通过计划式打卡强化）

**实际例子**：
```
【昨晚制定次日计划】
- 暗示：准备好书包放在椅子上
- 建议时间：早上8:00
- 优先级：高

【今天早上8:00】
→ 次日计划提醒："准备好书包放在椅子上"
→ 完成暗示 ✓
→ 系统询问："暗示已完成，是否执行惯常行为并打卡？"
→ 选择"完成并打卡"
→ 去图书馆学习
→ 填写打卡信息
```

#### 💡 设计理念

基于《习惯的力量》理论：

**习惯循环三要素**：
1. **暗示（Cue）** - 触发习惯的信号
2. **惯常行为（Routine）** - 你要执行的行为
3. **奖赏（Reward）** - 行为带来的满足感

**两种打卡方式的本质**：

**直接打卡**：
- 假设你已经有了触发习惯的机制
- 只需要记录"惯常行为"的执行情况

**计划式打卡**：
- 帮助你**建立和强化触发机制**
- 通过次日计划的"暗示任务"，明确告诉你何时、何地、如何触发这个习惯
- 完成暗示 → 执行行为，完整体验习惯循环

#### 🧠 心理学优势（计划式打卡）

1. **明确的触发信号**：
   - 暗示任务清晰告诉你何时开始
   - 减少"要不要做"的心理斗争

2. **行为路径具体化**：
   - 暗示 → 行为的连接更紧密
   - 大脑更容易形成自动化反应

3. **完成感加倍**：
   - 完成暗示任务 ✓
   - 执行惯常行为 ✓
   - 双重成就感强化习惯

4. **数据追踪更完整**：
   - 记录计划执行率
   - 分析哪些暗示最有效

#### 📝 推荐使用策略

**简单来说**：
- **直接打卡** = 已经做完了，现在记录一下
- **计划式打卡** = 提前计划好暗示，按计划执行，强化习惯循环

**推荐**：
- 如果你在培养新习惯或想要强化触发机制，推荐使用**次日计划 + 计划式打卡**
- 如果习惯已经很稳定，**直接打卡**更方便快捷

---

### Q2: 什么是核心习惯（💎）？

核心习惯（Keystone Habit）是指那些不仅本身重要，更重要的是会**引发连锁反应**，带动其他习惯形成的习惯。

**示例**：
- 核心习惯：每天运动 30 分钟
  - → 影响习惯：健康饮食（运动后更关注营养）
  - → 影响习惯：早睡早起（运动消耗体力，促进睡眠）
  - → 影响习惯：提高工作效率（运动改善精神状态）

**当前功能**（Phase 2）：
- ✅ 手动标记核心习惯（创建/编辑习惯时切换开关）
- ✅ 习惯卡片显示 💎 橙色徽章
- ✅ 筛选功能（全部/仅核心/仅普通）
- ✅ 次日计划中核心习惯默认高优先级

**未来规划**（Phase 3+）：
- 习惯关联管理（记录核心习惯影响的其他习惯）
- 可视化影响网络（力导向图展示习惯关系）
- 连锁效应统计（量化核心习惯对其他习惯的影响）

详见：[PLAN.md - 核心习惯功能](../PLAN.md#week-2-扩展核心习惯keystone-habits功能-)

---

### Q3: 习惯的暗示（Cue）应该如何设置？

暗示是触发习惯的信号，越具体越容易触发。推荐使用**5W1H**原则：

**好的暗示示例**：
- ✅ "每天早上6点闹钟响后，看到床边的运动鞋"
- ✅ "晚饭后坐在书桌前，看到打开的书"
- ✅ "下班回家进门，看到放在玄关的吉他"

**不好的暗示示例**：
- ❌ "想起来的时候"（太模糊）
- ❌ "有空的时候"（缺乏具体触发条件）
- ❌ "心情好的时候"（依赖情绪，不稳定）

**设置技巧**：
1. **视觉触发**：将习惯工具放在显眼位置
2. **时间触发**：固定的时间点（如早上7点）
3. **地点触发**：特定的地点（如书桌前）
4. **事件触发**：某个事件之后（如晚饭后）
5. **组合触发**：时间+地点+视觉（如"早上8点在书桌前看到打开的笔记本"）

---

### Q4: 如何养成一个新习惯？

基于《习惯的力量》理论，推荐以下步骤：

#### Step 1: 创建习惯
1. 打开"习惯追踪"页面
2. 点击右上角 ➕ 按钮
3. 填写习惯三要素：
   - **暗示**：具体的触发信号（见 Q3）
   - **惯常行为**：要执行的具体行为
   - **奖赏**：行为带来的满足感
4. 如果是核心习惯，开启 💎 标记

#### Step 2: 制定次日计划
1. 打开"次日计划"页面（习惯页面右上角 📅 图标）
2. 点击 ➕ 生成次日计划
3. 选择要执行的习惯
4. 为每个习惯设置建议时间和优先级
5. 生成计划

#### Step 3: 执行计划
1. 次日查看"今日计划"
2. 按时间顺序执行暗示任务
3. 完成暗示后，选择"完成并打卡"
4. 执行惯常行为
5. 填写打卡信息（时间、质量、笔记）

#### Step 4: 坚持 21 天
- 习惯形成通常需要 21-66 天
- 通过次日计划强化触发机制
- 查看统计数据保持动力
- 达成连续 7/30 天会有成就通知

#### Step 5: 定期回顾
1. 查看习惯详情页的统计卡片
2. 分析日历热力图找出规律
3. 在"习惯感悟"中记录体会
4. 调整暗示或奖赏以优化习惯循环

---

## 📊 数据管理相关

### Q5: 如何在多设备间同步数据？

**当前方案**（Phase 2 已实现）：

通过**导出/导入功能**实现跨设备同步：

#### iPhone → macOS 同步流程：

1. **iPhone 导出数据**：
   - 打开"我的"页面
   - 点击"导出数据"
   - 选择 JSON 格式（推荐）
   - 选择导出范围（全量/增量）
   - 分享到 AirDrop/iCloud Drive

2. **macOS 导入数据**：
   - 打开"我的"页面
   - 点击"导入数据"
   - 选择刚才导出的 JSON 文件
   - 查看导入预览（将导入 X 个习惯，检测到 Y 个冲突）
   - 选择合并策略：
     - "保留新数据"（iPhone 优先）
     - "保留旧数据"（macOS 优先）
     - "智能合并"（按更新时间，推荐）
     - "手动选择"（逐项确认冲突）
   - 执行导入
   - 查看导入结果报告

#### 支持的格式：
- **JSON**：跨设备同步首选，包含完整数据结构
- **CSV**：数据分析用途（habits.csv, records.csv, plans.csv）
- **Markdown**：可读报告（仅导出，不支持导入）

**未来规划**（Phase 5+）：
- iCloud 自动备份（iOS）
- 云端实时同步（Go 后端 + PostgreSQL）
- 多设备实时同步
- 自动冲突解决

详见：[docs/requirements.md - 数据导入导出](requirements.md#数据备份与导入导出-)

---

### Q6: 导入数据时如何处理冲突？

当同一习惯在两个设备都存在且内容不同时，会产生冲突。系统提供 4 种合并策略：

#### 1. 保留新数据（导入文件优先）
- 导入文件的数据完全覆盖当前设备数据
- 适用场景：从主力设备导出，其他设备导入

#### 2. 保留旧数据（当前设备优先）
- 当前设备的数据保留，忽略导入文件的冲突数据
- 适用场景：误操作导入，想保留当前数据

#### 3. 智能合并（按更新时间，推荐）
- 对比两侧数据的 `updated_at` 时间戳
- 保留更新时间晚的数据
- 适用场景：日常同步，自动选择最新数据

#### 4. 手动选择（逐项确认冲突）
- 显示冲突对比 UI：
  - 左侧：当前设备数据
  - 右侧：导入文件数据
  - 按钮：保留左侧/保留右侧/合并
- 适用场景：重要数据，需要仔细确认

#### 冲突类型：
- **习惯冲突**：同一习惯名称和暗示不同
- **记录冲突**：同一天同一习惯多次打卡（保留最新质量评分）
- **计划冲突**：同一天同一习惯的计划不同（合并去重）
- **Frontmatter 冲突**：同一标题的感悟内容不同（按创建时间合并）

---

## 🔧 技术问题相关

### Q7: 为什么 macOS 调试时提示"Operation not permitted"？

**错误信息**：
```
SocketException: Failed to create server socket
(OS Error: Operation not permitted, errno = 1)
```

**原因**：
macOS App Sandbox 缺少网络权限，导致 Flutter 的 VM Service 无法监听端口进行调试。

**解决方案**：

1. 在 `macos/Runner/DebugProfile.entitlements` 中添加：
```xml
<key>com.apple.security.network.server</key>
<true/>
<key>com.apple.security.network.client</key>
<true/>
```

2. 在 `macos/Runner/Release.entitlements` 中添加：
```xml
<key>com.apple.security.network.client</key>
<true/>
```

3. 执行 `flutter clean` 并重启调试

详见：[README.md - 问题4](../README.md#问题-4-vs-code-调试时-vm-service-无法启动)

---

### Q8: VS Code Dart 扩展无法识别 Flutter SDK？

**解决方案**：

在 `.vscode/settings.json` 中配置：

```json
{
  // ✅ 推荐：使用 FVM 符号链接（跨设备兼容）
  "dart.flutterSdkPath": ".fvm/flutter_sdk"
}
```

**为什么这样配置**：
- FVM 在项目根目录创建 `.fvm/flutter_sdk` 符号链接
- 该链接指向全局 FVM 缓存中的实际 SDK
- 切换版本时（`fvm use`），链接自动更新
- 跨设备兼容，其他开发者克隆项目后链接自动指向他们机器上的 FVM 路径

**配置后需要**：
1. 重启 Dart Analysis Server：`Cmd+Shift+P` → "Dart: Restart Analysis Server"
2. 验证 SDK：`Cmd+Shift+P` → "Flutter: Run Flutter Doctor"

详见：[CLAUDE.md - FVM 配置](../CLAUDE.md#fvm-配置)

---

## 📚 更多文档

- [完整需求文档](requirements.md)
- [习惯追踪模块文档](habit/README_HABITS.md)
- [次日计划用户指南](habit/DAILY_PLAN_USER_GUIDE.md)
- [开发计划](../PLAN.md)
- [技术架构](../technical_architecture_zh.md)

---

**文档版本**: v1.0
**最后更新**: 2025-10-05
**维护者**: 项目团队
